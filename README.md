# Github Repository Researcher

Search and
list repositories throughout Github.
Given a Github repository query string,
returns a list of repositories matching the query string,
within their name, description, author's name and
the number of stars.
You can see how to formulate repository query strings at [Searching for
repositories](https://help.github.com/en/github/searching-for-information-on-github/searching-for-repositories).
For example,
the query **`language:javascript sort:stars`** retries the most stared repositories on Github.

When clicking on one of the results,
the system presents more detailed information about the repository,
as the number of open issues,
the main language of the project,
its date of creation and
a list of other repositories by the same author.

This work was mostly based on the tutorials:
1. https://github.com/sazzer/docker-test ([blog post](https://blog.pusher.com/full-stack-testing-docker-compose/))
1. https://github.com/ryanjyost/react-responsive-tutorial ([blog post](https://codeburst.io/how-to-build-fully-responsive-react-apps-with-nothing-but-inline-styles-and-javascript-242c091b6ba1))


___
## Table of Contents

- [Github Repository Researcher](#github-repository-researcher)
  * [Table of Contents](#table-of-contents)
  * [RestAPI](#restapi)
    + [`/search_github`](#search_github)
    + [`/list_repositories`](#list_repositories)
    + [`/detail_repository`](#detail_repository)
  * [Deployment (Docker)](#deployment-docker)
    + [Requirements](#requirements)
    + [Installation](#installation)
    + [Debugging Commands](#debugging-commands)
    + [Running Tests (Continuous Integration)](#running-tests-continuous-integration)
  * [Development](#development)
    + [Requirements](#requirements-1)
    + [Installation](#installation-1)
    + [Running Tests](#running-tests)

* The table of contents used on this Markdown was generated by:
  1. `git clone https://github.com/evandroforks/markdown-toc`
  1. `cd markdown-toc`
  1. `npm -g install`
  1. `cd ../repository-root`
  1. `markdown-toc README.MD`


___
## RestAPI

For frontend application consume data from the implemented backend by using a Restful API.
The available endpoints are:

### **`/search_github`**

This is a **`POST`** endpoint which accepts **`JSON`** on the following format:
```json
{
    "searchQuery": "term to search on github",
    "lastItemId": "[optional field, defaults to null]",
    "itemsPerPage": 0
}
```
1. **`lastItemId`** is an item identification to indicate the last item already fetched.
1. **`itemsPerPage`** [optional field, defaults to 3] is the maximum items count to return by a request.

The result of this request is another **`JSON`**,
within a list of repositories matching the **`searchQuery`** up to **`itemsPerPage`** results for the given **`lastItemId`**.
The resulting **`JSON`** has the following format:
```json
{
  "rateLimit": "User evandrocoan, rate limit 4975, cost 1, remaining 4975, ..., ",
  "hasMorePages":true,
  "lastItemId":"Y3Vyc29yOnYyOpIJzgKrPxE=",
  "repositoryCount": 9280591,
  "repositories": [
    {
      "nameWithOwner": "twbs/bootstrap",
      "description": "The most popular HTML, CSS, and JavaScript framework...",
      "stargazers": {
        "totalCount": 138509
      }
    }
  ]
}
```
1. **`hasMorePages`** a boolean value determining whether there are new pages to show.
1. **`repositoryCount`** is the total number of repositories found on the search.
1. **`repositories`** are all repositories found from the requested **`lastItemId`** up to the given the **`itemsPerPage`** on the initial
   **`POST`** request.

### **`/list_repositories`**

This is a **`POST`** endpoint which accepts **`JSON`** on the following format:
```json
{
    "repositoryUser": "user name to fetch more details from",
    "lastItemId": "[optional field, defaults to null]",
    "itemsPerPage": 0
}
```
1. **`lastItemId`** The same as **`/search_github -> lastItemId`**.
1. **`itemsPerPage`** The same as **`/search_github -> itemsPerPage`**.

The result of this request is another **`JSON`**,
within a list of repositories matching the **`repositoryUser`** up to **`itemsPerPage`** results for the given **`lastItemId`**.
The resulting **`JSON`** has the following format:
```json
{
  "rateLimit": "User evandrocoan, rate limit 4975, cost 1, remaining 4975, ..., ",
  "hasMorePages":true,
  "lastItemId":"Y3Vyc29yOnYyOpIJzgKrPxE=",
  "repositories":[
    {
      "name":"ITE"
    },
    {
      "name":"PlantUmlDiagrams"
    },
    {
      "name":"MultiModServer"
    }
  ]
}
```
1. **`hasMorePages`** The same as **`/search_github -> hasMorePages`**.
1. **`lastItemId`** The same as **`/search_github -> lastItemId`**.
1. **`repositories`** The same as **`/search_github -> repositories`**,
   except that here are only included the repository names.

### **`/detail_repository`**

This is a **`POST`** endpoint which accepts **`JSON`** on the following format:
```json
{
    "repositoryUser": "the name of the user owner of the repository",
    "repositoryName": "the name of the repository to get detailed information"
}
```
The result of this request is another **`JSON`**,
within details about the given **`repositoryName`** from the requested **`repositoryUser`**.
The resulting **`JSON`** has the following format:
```json
{
  "rateLimit": "User evandrocoan, rate limit 4975, cost 1, remaining 4975, ..., ",
  "createdAt":"2016-08-09T21:16:45Z",
  "issues":{
    "totalCount":74
  },
  "languages":{
    "nodes":[
      {
        "name":"Shell"
      }
    ]
  }
}
```
1. **`createdAt`** The date of creation of the repository.
1. **`issues.totalCount`** the total of open issues on the repository.
1. **`languages.nodes.name`** the main language of the project.


___
## Deployment (Docker)

For easy deployment,
you can use docker with a pre-built docker container image.
The project works by using **`docker-compose`** to launch the backend and
frontend servers.

### Requirements

1. **`Docker 19.03.5`** or superior
    1. Do not install docker from your distro package manager because it is GUI application and not the real docker!
        1. https://stackoverflow.com/questions/30379381/docker-command-not-found-even-though-installed-with-apt-get
    1. For Ubuntu:
        1. https://docs.docker.com/install/linux/docker-ce/ubuntu/
    1. For Debian 9:
        1. https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-debian-9
    1. For Windows:
        1. https://www.docker.com/get-started
    1. For any other distro, search on google with **`docker install <distro name>`**
        1. https://docker-curriculum.com/
        1. https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user
1. **`docker-compose 1.23.1`** or superior
    1. For Debian 9:
        1. https://linuxize.com/post/how-to-install-and-use-docker-compose-on-debian-9/

### Installation

1. **`git clone https://github.com/evandrocoan/GithubRepositoryResearcher`**
1. **`cd GithubRepositoryResearcher`**
1. **`docker-compose up reactfrontend pythonbackend`**
    1. **`docker-compose up reactfrontend pythonbackend -d`** (to run in background)
    1. **`docker-compose stop`** (to stop background dockers)

### Debugging Commands

1. To rebuild the docker container:
    1. **`docker rmi <image>`**
    1. **`docker rm <container>`**
    1. **`docker image ls`**
    1. **`docker image prune -f`**
    1. **`docker-compose build reactfrontend pythonbackend`**
    1. **`docker-compose up --force-recreate --build reactfrontend pythonbackend`**
    1. **`docker build . -f Dockerfile-nodejs -t evandrocoan/ubuntu18nodejspython`**
    1. To clear all docker images (to free space):
       1. **`docker container prune`**
       1. **`docker system prune --volumes`**
       1. **`docker rm -vf $(docker ps -a -q)`**
       1. **`docker image prune --all`** By default Docker will not remove named images, even if they are unused. This command will remove unused images: https://stackoverflow.com/questions/46672001/is-it-safe-to-clean-docker-overlay2
1. **`docker-compose ps`** (to list running containers)
1. **`docker-compose --verbose up`**
1. **`docker-compose run --entrypoint /bin/bash <container>`**
    1. It is the same as **`docker run -it <container> /bin/bash`**
    1. Then run: **`nslookup pythonbackend`** inside a docker to resolve the container ip address
1. Working with images:
    1. **`docker image ls`** (to list containers images)
    1. **`docker ps -n10 -s`** (to list exited containers)
    1. **`docker containers ls`** (to list running containers)
1. Open an image and run a iterative shell:
    1. **`docker imagens`** (to list available images/containers)
    1. **`docker run -it githubrepositoryresearcher_tests /bin/bash`**
    1. **`docker run -it evandrocoan/ubuntu18nodejspython /bin/bash`**
1. Useful links:
    1. https://docs.docker.com/engine/reference/builder/
    1. https://vsupalov.com/docker-arg-env-variable-guide/
    1. https://nickjanetakis.com/blog/docker-tip-3-chain-your-docker-run-instructions-to-shrink-your-images
    1. https://stackoverflow.com/questions/31222377/what-are-docker-image-layers
    1. https://stackoverflow.com/questions/40801772/what-is-the-difference-between-docker-compose-ports-vs-expose

### Running Tests (Continuous Integration)

Uses **`docker-compose`** to run all services,
including the tests service.

1. **`docker-compose build reactfrontend`** (build **`reactfrontend`** first because the **`tests`** service depends on it)
1. **`docker-compose up --exit-code-from tests`** (automatically stop the containers when the tests are finished)
    1. https://stackoverflow.com/questions/38440876/stand-up-select-services-with-docker-compose
    1. https://www.ostechnix.com/explaining-docker-volumes-with-examples/


___
## Development

To develop this project,
locally install its dependencies and
directly run the Python backend (**`run_backend.sh`**) and
Nodejs frontend (**`run_frontend.sh`**) servers on different terminals.

### Requirements

1. **`Python 3.6.7`** or superior (https://www.python.org/downloads/)
    1. https://linuxize.com/post/how-to-install-python-3-7-on-debian-9/
1. **`pip 3`** (https://pypi.org/project/pip/)
1. **`NodeJS v12.14.1`** or superior
    1. https://nodejs.org/en/download/
    1. https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions-enterprise-linux-fedora-and-snap-packages

### Installation

1. **`git clone https://github.com/evandrocoan/GithubRepositoryResearcher`**
1. **`cd GithubRepositoryResearcher`**
1. **`python3 -m pip install -r requirements.txt`**
1. Create the environment variables file **`env.sh`** as the following or
   just export these variables before running the project:
    ```shell
    #!/bin/bash
    : ${GITHUB_RESEARCHER_PIP_PATH:="pip3"}; export GITHUB_RESEARCHER_PIP_PATH
    : ${GITHUB_RESEARCHER_PYTHON_PATH:="python3"}; export GITHUB_RESEARCHER_PYTHON_PATH

    : ${REACT_APP_GITHUB_RESEARCHER_TOKEN:=""}; export REACT_APP_GITHUB_RESEARCHER_TOKEN
    : ${REACT_APP_GITHUB_RESEARCHER_DEBUG_LEVEL:="127"}; export REACT_APP_GITHUB_RESEARCHER_DEBUG_LEVEL

    : ${REACT_APP_GITHUB_RESEARCHER_BACKEND_IP:="127.0.0.1"}; export REACT_APP_GITHUB_RESEARCHER_BACKEND_IP
    : ${REACT_APP_GITHUB_RESEARCHER_BACKEND_PORT:="9000"}; export REACT_APP_GITHUB_RESEARCHER_BACKEND_PORT
    : ${REACT_APP_GITHUB_RESEARCHER_FRONTEND_PORT:="3000"}; export REACT_APP_GITHUB_RESEARCHER_FRONTEND_PORT
    ```
    1. Do not forget to fill out the **`REACT_APP_GITHUB_RESEARCHER_TOKEN`** variable.
       See [Creating a personal access token for the command
       line](https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line).
       Your token does not have to have any special permissions to work with this tool.
    1. You only need to export the variables which their presented default requires changing.
1. Open a command line and run **`bash run_backend.sh`**
1. Now,
   open another command line on the same directory and
   run the commands:
    1. **`cd reactfrontend`**
    1. **`npm install`**
    1. **`cd ..`**
    1. **`bash run_frontend.sh`**

### Running Tests

1. First follow the **`Installation`** steps just above and
   put the backend and
   frontend servers up and
   running.
1. **`bash run_tests.sh`** (to run all tests)
    1. Run **`bash run_tests.sh -h`** to learn more about command line options available.
